/*! baidu-map 2014-07-31 */
/*!luzuoquan*/
!function(){var a=function(){};a.prototype={initCon:function(){}},window.Control=a}();var config={initUrl:{getMapData:"service/getData.php"}};!function(a,b,c,d,e){{var f=new c;new d,new e,document.getElementById("map-container")}b.ajax({url:a.initUrl.getMapData,type:"POST",dataType:"json",data:{},error:function(a){console.log(a)},success:function(a){var b="";b=f.pageList(a.d),f.loadData(b),f.pageNext(b),f.pagePrev(b),f.initMap(a.d)}})}(config,jQuery,View,Control,Model),function(){var a=function(){this.a=123};a.prototype={getModelData:function(){},setModelData:function(){}},window.Model=a}(),function(){var a=function(a){this.pageCount=3,this.oMap=null,this.DataSet=a||null,this.currentPage=1,this.totalPage=$("#totalpage"),this.isPaint=!1,this.prevPoly="",this.singleDetail=document.getElementById("single-detail"),this.selfList=document.getElementById("self-list"),this.mapConfig={defaultCity:"重庆",defaultZoom:9,defaultMapType:BMAP_HYBRID_MAP,defaultMapId:"map-container",defaultPoints:new BMap.Point(106.524203,29.516936),maxZoom:17,minZoom:9},this.polygonOp={strokeColor:"red",fillColor:"yellow",strokeWeight:2,strokeOpacity:.7,fillOpacity:.3,strokeStyle:"solid"},this.polygonHOp={strokeColor:"red",fillColor:"yellow",strokeWeight:3,strokeOpacity:.7,fillOpacity:.5,strokeStyle:"solid"}};a.prototype={loadData:function(a,b){var b=b||0,c=document.getElementById("datalist"),d=a[b];$(".data-container").empty(),$(c).tmpl(d).appendTo(".data-container")},fileClick:function(){var a=document.getElementById("filebtn"),b=document.getElementById("fileimg");$(a).on("click",function(){b.click()})},backToList:function(){var a=this,b=document.getElementById("returnlist");$(b).on("click",function(){a.prevPoly&&a.oMap.removeOverlay(a.prevPoly),a.oMap.reset(),a.selfList.style.display="block",a.singleDetail.style.display="none"})},checkMap:function(){var a=this;$("body").on("click",".maplook",function(){var b=$(this).parent("div"),c=b.attr("data-point"),d=b.attr("data-points");if(a.selfList.style.display="none",a.singleDetail.style.display="block",d){var e=a._pointsToOverlay(d),f=new BMap.Polygon(e,a.polygonHOp);a.prevPoly&&a.oMap.removeOverlay(a.prevPoly),a.oMap.setCenter(a.oMap.getViewport(f.getPath()).center),a.oMap.addOverlay(f),a.prevPoly=f}else{if(!c)return;a.oMap.setCenter(new BMap.Point(c.split(",")[0],c.split(",")[1]))}})},editMap:function(){$("body").on("click",".mapedit",function(a){a.preventDefault()})},paintMarker:function(){},paintPolygon:function(){},mapFixed:function(a){var b=this;if(a){var c=document.getElementById("fixedmap");$(c).on("click",function(c){b.isPaint=!0,a.disableScrollWheelZoom(),a.disableDoubleClickZoom(),a.disableKeyboard(),a.disableDragging(),c.preventDefault()})}},mapLift:function(a){if(a){var b=document.getElementById("liftmap"),c=this;$(b).on("click",function(b){c.isPaint=!1,a.enableDoubleClickZoom(),a.enableDragging(),a.enableKeyboard(),a.enableScrollWheelZoom(),b.preventDefault()})}},pageList:function(a){for(var b,c=this.pageCount,d=[],e=0,f=0;b=a[f];f++)f%c==0&&(d[e]=[],e++),d[e-1].push(b);return this.totalPage.html(d.length),d},pageNext:function(a){var b=$("#mapnext"),c=this;b.on("click",function(){return c.currentPage==c.totalPage.html()?void b.addClass("disabled"):(b.removeClass("disabled"),$("#mapprev").removeClass("disabled"),c.currentPage++,$("#current").html(c.currentPage),c.loadData(a,c.currentPage-1),void 0)})},pagePrev:function(a){var b=$("#mapprev"),c=this;b.on("click",function(){return 1==c.currentPage?void b.addClass("disabled"):(b.removeClass("disabled"),$("#mapnext").removeClass("disabled"),c.currentPage--,$("#current").html(c.currentPage),c.loadData(a,c.currentPage-1),void 0)})},overlayPoly:function(a){var b=this;if(a)for(var c=a.length,d=0;c>d;d++){if(a[d].points){var e=this._pointsToOverlay(a[d].points),f=new BMap.Polygon(e,b.polygonOp);b.oMap.addOverlay(f)}if(a[d].point){var g=this._pointToOverlay(a[d].point),h=new BMap.Marker(g);b.oMap.addOverlay(h)}}},overlayMarker:function(a){if(a){new BMap.Marker(new BMap.Point(a))}},_pointsToOverlay:function(a){for(var b=[],c=a.split("|"),d=c.length,e=0;d>e;e++){var f=c[e].split(",");b.push(new BMap.Point(f[0],f[1]))}return b},_pointToOverlay:function(a){var b=a.split(","),c=new BMap.Point(b[0],b[1]);return c},initMap:function(a){{var b=this;$("#mapprev"),$("#mapnext")}b.oMap=new BMap.Map(b.mapConfig.defaultMapId),b.oMap.setMapType(b.mapConfig.defaultMapType),b.oMap.centerAndZoom(b.mapConfig.defaultPoints,b.mapConfig.defaultZoom),b.oMap.enableScrollWheelZoom(),b.oMap.addControl(new BMap.NavigationControl),b.oMap.enableKeyboard(),b.overlayPoly(a,!0),b.overlayMarker(a,!0),b.mapFixed(b.oMap),b.mapLift(b.oMap),b.checkMap(),b.backToList()}},window.View=a}();